---
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: ${{ values.app_name }}
      labels:
        app: ${{ values.app_name }}
      namespace: ${{ values.app_name }}
    spec:
      replicas: 2
      selector:
        matchLabels:
          app: ${{ values.app_name }}
      strategy:
        rollingUpdate:
          maxSurge: 25%
          maxUnavailable: 25%
        type: RollingUpdate
      template:
        metadata:
          labels:
            app: ${{ values.app_name }}
        spec:
          containers:
          - image: ghcr.io/kroy76/app-${{ values.app_name }}:latest
                           
            imagePullPolicy: Always
            name: ${{ values.app_name }}
            ports:
            - containerPort: 8080
              protocol: TCP
---
    apiVersion: v1
    kind: Service
    metadata:
      name: ${{ values.app_name }}
      namespace: ${{ values.app_name }}
    spec:
      selector:
        app: ${{ values.app_name }}
      ports:
       -  protocol: TCP
          port: 80
          targetPort: 8080
---
    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      namespace: ${{ values.app_name }}
      name: ${{ values.app_name }}
      annotations:
        alb.ingress.kubernetes.io/scheme: internal
        alb.ingress.kubernetes.io/target-type: ip
    spec:
      ingressClassName: alb
      rules:
        - http:
            paths:
            - path: /
              pathType: Prefix
              backend:
                service:
                  name: ${{ values.app_name }}
                  port:
                    number: 80